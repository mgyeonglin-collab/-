<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TrashTrade ğŸŒ¿ â€” ì¹œí™˜ê²½ êµí™˜ í”Œë«í¼</title>
<link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
<style>
:root {
  --main-green: #6BA368;
  --light-green: #A1C181;
  --ivory: #F7F4EA;
  --accent-yellow: #F9CC66;
  --text-dark: #2B2B2B;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Gowun Batang', serif;
  background: var(--ivory);
  color: var(--text-dark);
  padding-bottom: 80px;
}

/* Header */
header {
  background: var(--light-green);
  color: white;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 14px 24px;
  border-bottom: 3px solid var(--main-green);
  border-radius: 10px;
}
header h1 { font-size: 22px; }
.cta-btn {
  background: var(--accent-yellow);
  border: none;
  border-radius: 10px;
  padding: 8px 14px;
  cursor: pointer;
  font-weight: bold;
}

/* Hero */
.hero {
  background: white;
  margin: 24px auto;
  border-radius: 16px;
  padding: 24px;
  text-align: center;
  max-width: 960px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.08);
}
.hero h2 { color: var(--main-green); margin-bottom: 10px; }

/* Controls */
.controls {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin: 16px 0;
}
.controls input, .controls select {
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
}

/* Item Grid */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 16px;
  max-width: 960px;
  margin: auto;
}
.card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
  overflow: hidden;
  transition: transform .15s;
}
.card:hover { transform: translateY(-4px); }
.card img { width: 100%; height: 160px; object-fit: cover; }
.card-content { padding: 12px; }
.card-content h3 { color: var(--main-green); margin-bottom: 4px; }
.exchange-btn {
  background: var(--main-green);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  margin-top: 8px;
}

/* Sidebar */
.sidebar {
  position: fixed;
  right: -340px;
  top: 0;
  width: 320px;
  height: 100%;
  background: white;
  box-shadow: -4px 0 12px rgba(0,0,0,0.1);
  padding: 16px;
  border-top-left-radius: 12px;
  border-bottom-left-radius: 12px;
  transition: right 0.35s ease;
  z-index: 20;
}
.sidebar.open { right: 0; }
.sidebar-toggle {
  position: fixed;
  top: 90px;
  right: 20px;
  background: var(--main-green);
  color: white;
  border: none;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  cursor: pointer;
  font-size: 20px;
  z-index: 30;
}

/* Modal */
.modal-bg {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 50;
}
.modal {
  background: white;
  border-radius: 10px;
  padding: 20px;
  max-width: 460px;
  width: 100%;
}
.modal.show { display: flex; }

/* Footer */
footer {
  text-align: center;
  margin-top: 40px;
  font-size: 13px;
  color: #777;
}
</style>
</head>
<body>

<header>
  <h1>TrashTrade ğŸŒ¿</h1>
  <div>
    <button class="cta-btn" id="registerBtn">ë¬¼í’ˆ ë“±ë¡</button>
    <button class="cta-btn" id="loginBtn">í”„ë¡œí•„</button>
  </div>
</header>

<section class="hero">
  <h2>í•™êµ ì•ˆì—ì„œ, ì§€ì—­ ì•ˆì—ì„œ ë‹¤ì‹œ ì“°ëŠ” ê¸°ì¨ ğŸŒ</h2>
  <p>ì¹œí™˜ê²½ êµí™˜ í”Œë«í¼ TrashTradeì™€ í•¨ê»˜ ì‘ì€ ìˆœí™˜ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
</section>

<div class="controls">
  <input type="text" id="searchInput" placeholder="ë¬¼í’ˆ ê²€ìƒ‰">
  <select id="categoryFilter">
    <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
    <option value="ì±…">ì±…</option>
    <option value="ì˜ë¥˜">ì˜ë¥˜</option>
    <option value="ì „ìê¸°ê¸°">ì „ìê¸°ê¸°</option>
  </select>
</div>

<div id="grid" class="grid"></div>

<button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
<div class="sidebar" id="sidebar">
  <h3>ë‚´ í”„ë¡œí•„</h3>
  <p id="profileInfo">ë¡œê·¸ì¸í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
  <hr style="margin:10px 0;">
  <h4>í¬ì¸íŠ¸ ìƒì </h4>
  <ul id="shopList"></ul>
  <hr style="margin:10px 0;">
  <h4>ë­í‚¹</h4>
  <ul id="rankingList"></ul>
</div>

<footer>ğŸŒ± TrashTrade â€” í•¨ê»˜ ë§Œë“œëŠ” ì‘ì€ ìˆœí™˜, í° ë³€í™” ğŸŒ</footer>

<div class="modal-bg" id="modalBg">
  <div class="modal" id="modal"></div>
</div>

<script>
let currentUser = JSON.parse(localStorage.getItem("currentUser")) || null;
let items = JSON.parse(localStorage.getItem("items")) || [];
let users = JSON.parse(localStorage.getItem("users")) || [];
const grid = document.getElementById("grid");
const sidebar = document.getElementById("sidebar");
const modalBg = document.getElementById("modalBg");
const modal = document.getElementById("modal");
const shopList = document.getElementById("shopList");
const rankingList = document.getElementById("rankingList");
const profileInfo = document.getElementById("profileInfo");

function saveAll() {
  localStorage.setItem("users", JSON.stringify(users));
  localStorage.setItem("items", JSON.stringify(items));
  localStorage.setItem("currentUser", JSON.stringify(currentUser));
}

/* Sidebar toggle */
document.getElementById("sidebarToggle").onclick = () => {
  sidebar.classList.toggle("open");
};

/* Login */
document.getElementById("loginBtn").onclick = () => {
  modalBg.style.display = "flex";
  modal.innerHTML = `
    <h3>ë¡œê·¸ì¸</h3>
    <input id="name" placeholder="ì´ë¦„" style="width:100%;margin:6px 0;">
    <input id="school" placeholder="í•™êµ" style="width:100%;margin:6px 0;">
    <button id="loginConfirm" class="cta-btn" style="margin-top:10px;">í™•ì¸</button>
  `;
  document.getElementById("loginConfirm").onclick = () => {
    const name = document.getElementById("name").value.trim();
    const school = document.getElementById("school").value.trim();
    if (!name || !school) return alert("ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    let user = users.find(u => u.name === name && u.school === school);
    if (!user) {
      user = { id: Date.now(), name, school, points: 0 };
      users.push(user);
    }
    currentUser = user;
    saveAll();
    modalBg.style.display = "none";
    render();
  };
};

/* Register item */
document.getElementById("registerBtn").onclick = () => {
  if (!currentUser) return alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”!");
  modalBg.style.display = "flex";
  modal.innerHTML = `
    <h3>ë¬¼í’ˆ ë“±ë¡</h3>
    <input id="title" placeholder="ë¬¼í’ˆëª…" style="width:100%;margin:6px 0;">
    <input id="category" placeholder="ì¹´í…Œê³ ë¦¬ (ì±…/ì˜ë¥˜ ë“±)" style="width:100%;margin:6px 0;">
    <textarea id="desc" placeholder="ì„¤ëª…" style="width:100%;margin:6px 0;"></textarea>
    <button id="addItem" class="cta-btn" style="margin-top:10px;">ë“±ë¡</button>
  `;
  document.getElementById("addItem").onclick = () => {
    const title = document.getElementById("title").value;
    const category = document.getElementById("category").value;
    const desc = document.getElementById("desc").value;
    items.push({ id: Date.now(), title, category, desc, owner: currentUser.name, school: currentUser.school, status: "available" });
    saveAll();
    modalBg.style.display = "none";
    render();
  };
};

/* Close modal */
modalBg.onclick = (e) => { if (e.target === modalBg) modalBg.style.display = "none"; };

/* Exchange */
function requestExchange(itemId) {
  const item = items.find(i => i.id === itemId);
  if (item.owner === currentUser.name) return alert("ë³¸ì¸ ë¬¼í’ˆì…ë‹ˆë‹¤.");
  if (confirm(`${item.owner}ì—ê²Œ êµí™˜ì„ ìš”ì²­í• ê¹Œìš”?`)) {
    item.status = "traded";
    currentUser.points += 10;
    const owner = users.find(u => u.name === item.owner);
    if (owner) owner.points += 10;
    saveAll();
    alert("ê±°ë˜ ì™„ë£Œ! ì„œë¡œì—ê²Œ 10í¬ì¸íŠ¸ ì§€ê¸‰ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸŒ±");
    render();
  }
}

/* Render */
function render() {
  grid.innerHTML = items.map(i => `
    <div class="card">
      <img src="https://picsum.photos/seed/${i.id}/300/160" alt="">
      <div class="card-content">
        <h3>${i.title}</h3>
        <p>${i.desc}</p>
        <small>${i.category} Â· ${i.school}</small><br>
        ${i.status === "available" ? `<button class="exchange-btn" onclick="requestExchange(${i.id})">êµí™˜ ìš”ì²­</button>` : `<em style="color:gray">ê±°ë˜ ì™„ë£Œ</em>`}
      </div>
    </div>
  `).join('');

  if (currentUser) {
    profileInfo.innerHTML = `<strong>${currentUser.name}</strong> (${currentUser.school})<br>í¬ì¸íŠ¸: ${currentUser.points}`;
  }

  // ìƒì 
  const shop = [
    { name: "ì”¨ì•— í‚¤íŠ¸", cost: 30 },
    { name: "ì—ì½” ìŠ¤í‹°ì»¤", cost: 20 },
    { name: "ë¦¬ìœ ì¦ˆ í…€ë¸”ëŸ¬", cost: 60 }
  ];
  shopList.innerHTML = shop.map(s => `
    <li>${s.name} â€” ${s.cost}P <button onclick="buyItem('${s.name}',${s.cost})">êµ¬ë§¤</button></li>
  `).join('');

  // ë­í‚¹
  const ranked = [...users].sort((a,b)=>b.points-a.points).slice(0,5);
  rankingList.innerHTML = ranked.map(u=>`<li>${u.name} (${u.points}P)</li>`).join('');
}

/* Buy item */
function buyItem(name, cost) {
  if (!currentUser) return alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”!");
  if (currentUser.points < cost) return alert("í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
  if (!confirm(`${name}ì„(ë¥¼) ${cost}Pë¡œ êµ¬ë§¤í•˜ì‹œê² ì–´ìš”?`)) return;
  currentUser.points -= cost;
  saveAll();
  alert("êµ¬ë§¤ ì™„ë£Œ! ğŸ‰");
  render();
}

/* ì´ˆê¸° ë Œë”ë§ */
render();
</script>
</body>
</html>
